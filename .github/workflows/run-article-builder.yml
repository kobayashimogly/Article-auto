name: Build Articles

on:
  workflow_dispatch:
    inputs:
      keyword_list:
        description: "æ”¹è¡ŒåŒºåˆ‡ã‚Šã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸€è¦§"
        required: true
        type: string

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      SERPAPI_KEY: ${{ secrets.SERPAPI_KEY }}
      GMAIL_USER: ${{ secrets.GMAIL_USER }}
      GMAIL_APP_PASSWORD: ${{ secrets.GMAIL_APP_PASSWORD }}

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Install dependencies
        run: npm install

      - name: Run All for each Keyword
        run: |
          echo "=== ğŸ“¥ å—ã‘å–ã£ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸€è¦§ ================="
          echo "${{ github.event.inputs.keyword_list }}"
          echo "================================================="

          IFS=$'\n'
          for KW in ${{ github.event.inputs.keyword_list }}; do
            echo " "
            echo "==============================================="
            echo " ğŸš€ å®Ÿè¡Œé–‹å§‹ï¼š$KW"
            echo "==============================================="

            node runAll.js "$KW"

            echo "-----------------------------------------------"
            echo " âœ” å®Œäº†ï¼š$KW"
            echo "-----------------------------------------------"
          done
